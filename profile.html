<!-- Create new file profile.html -->
<div class="profile-container">
  <h2>Your Profile</h2>
  <form id="profile-form">
    <div class="form-group">
      <label>Email</label>
      <input type="email" id="profile-email" disabled>
    </div>
    <div class="form-group">
      <label for="profile-name">Full Name</label>
      <input type="text" id="profile-name" required>
    </div>
    <div class="form-group">
      <label for="profile-phone">Phone</label>
      <input type="tel" id="profile-phone" required>
    </div>
    <button type="submit">Save Profile</button>
  </form>
</div>

<script>
  document.addEventListener('DOMContentLoaded', async () => {

    // 1. Check if logged in
    const { data: { user }, error: userError } = await supabase.auth.getUser();
    if (!user) {
      window.location.href = "login.html";
      return;
    }

    // 2. Fetch profile from the correct table: user_profiles
    const { data: profile, error: profileError } = await supabase
      .from('user_profiles')
      .select('*')
      .eq('user_id', user.id)
      .single();

    // 3. Fill the form
    document.getElementById('profile-email').value = user.email;

    if (profile) {
      document.getElementById('profile-name').value = profile.full_name || "";
      document.getElementById('profile-phone').value = profile.phone || "";
    }

    // 4. Save profile update
    document.getElementById('profile-form').addEventListener('submit', async (e) => {
      e.preventDefault();

      const updates = {
        user_id: user.id,
        email: user.email,
        full_name: document.getElementById('profile-name').value,
        phone: document.getElementById('profile-phone').value,
        updated_at: new Date()
      };

      const { error: updateError } = await supabase
        .from('user_profiles')
        .upsert(updates);

      if (updateError) {
        alert("Error updating profile: " + updateError.message);
        return;
      }

      alert('Profile updated!');
    });
  });
</script>
